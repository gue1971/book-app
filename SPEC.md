# ブックアプリ仕様書（v0.4）

## 1. 目的
モバイルファーストのブックアプリを構築し、全ページで縦長固定キャンバスと一貫したレイアウトを実現する。

## 2. キャンバス標準
- 全ページのマスターキャンバスは `1080x1920 px`（`9:16`）とする。
- 座標系:
  - 左上: `(0, 0)`
  - 右下: `(1080, 1920)`
- 実行時表示は `9:16` を維持し、等比スケーリングする。
- 主要コンテンツは実行時レイアウトでトリミングしない。

## 3. コンテンツセーフ領域（主方針）
- マスターキャンバス内に `1080x1800 px`（`3:5`）のセーフ領域を設ける。
- 縦方向の構成:
  - 上拡張帯: `60 px`（非重要ビジュアルのみ）
  - セーフ領域: `1800 px`（重要要素すべて）
  - 下拡張帯: `60 px`（非重要ビジュアルのみ）
- テキスト、顔、重要オブジェクトなどの主要要素は `1080x1800` 内に配置する。

## 4. 画面分割
- メイン領域: `1800 px`
- フッター領域: `120 px`
- 合計: `1920 px`
- フッターはナビゲーションおよびメタ情報UI専用とする。

## 5. ページ種別
- 表紙ページ
  - マスターキャンバス全面のキービジュアル
  - タイトルオーバーレイ
  - タップ/クリックで次へ進む
- 目次ページ
  - 項目リスト
  - 項目ページ（初期ビュー）へのジャンプ
- 項目ページ（本文ページ）
  - 項目を表示するページ
  - 項目は `1〜N` 個のビューを持てる
  - 注釈・用語補足は任意

## 6. ナビゲーション
- スワイプとタップ/クリックによる前後移動を提供する。
- ページ番号は線形インデックスとする:
  - `0 = 表紙`
  - `1 = 目次`
  - `2.. = 項目ページ`
- 目次の各項目は、対応する項目ページの初期ビューへジャンプする。
- 読書中は没入表示を標準とし、中央タップで操作オーバーレイを表示する。

## 7. 目次テンプレート標準
- 対象領域はメイン領域（`1080x1800`）のみとし、フッターは共通（`120 px`）とする。
- 目次タイトル「目次」はメイン領域上部に配置する。
- 目次の1行高さは `88 px` を標準とする。
- 1行の情報構成:
  - 左: 項目番号/ラベル
  - 中央: 項目タイトル（1行、長文は省略記号）
  - 右: 開始ページ（例 `p.12`、固定幅で右寄せ）
- 行区切り線:
  - 標準は「なし」（シンプル優先）
  - 区切りはボーダーではなく余白リズムで表現する。
- 目次は必ず「項目タイトル」と「開始ページ」を別情報として併記する。

## 8. アセット規約
- 納品サイズ（標準）は `1080x1920` とする。
- 制作用ソースは任意で `2160x3840`（2x）を許容し、納品時に縮小する。
- マンガ/本文画像の構図規約:
  - 重要要素は `1080x1800` セーフ領域に収める。
  - 上下 `60 px` は拡張余白としてのみ使用する。
- 命名規則:
  - 表紙: `cover_01.jpg`
  - 本文: `page_001.jpg`, `page_002.jpg` ...

## 9. アクセシビリティとUX
- 本文テキストは小型スマホでも可読性を確保する。
- 操作UIは必要に応じてキーボードフォーカス可能にする。
- 重要画像には意味のある `alt` テキストを付与する。
- 没入モード時は操作UIを常時表示しない。
- 中央タップで表示するオーバーレイに、設定・文字サイズ・栞・ページ移動スライダーを含める。
- オーバーレイは無操作時に自動で非表示へ戻る。

## 10. コンテンツモデル（項目 + ビュー）
- 本仕様は「項目（Entry）」を最小単位として管理する。
- 1項目は `1〜N` 個のビューを持てる。
- 項目ページの初期表示は、各項目に定義した「初期ビュー」とする。
- ユーザー向け表現は「ページ」で統一する。
  - 例: 目次からページへ移動、ページ内でビュー切替
- 標準ビュー種別:
  - `text`（本文）
  - `image`（画像/マンガ）
  - `quiz`（問題）
  - `answer`（解答）
  - `explanation`（解説）
  - `chart`（図表）

## 11. データ仕様（JSON）
- 必須フィールド（項目）:
  - `id`
  - `title`
  - `initialView`
  - `views`
- 必須フィールド（ビュー）:
  - `id`
  - `type`
  - `title`
  - `content`
- 例:
```json
{
  "id": "entry-001",
  "title": "第1項目",
  "initialView": "text",
  "views": [
    { "id": "v-text", "type": "text", "title": "本文", "content": "..." },
    { "id": "v-image", "type": "image", "title": "挿絵", "content": "/images/p001.jpg" }
  ]
}
```

## 12. 運用モード
- 導入コンテンツに応じて、以下を選択できる。
  - シンプル運用: `1項目 = 1ビュー`（通常の読書向け）
  - 拡張運用: `1項目 = 複数ビュー`（ノート/解説向け）
- 運用単位:
  - 作品単位で固定してよい。
  - 必要に応じて項目単位で拡張運用を有効化してよい。
- 共通要件:
  - いずれの運用でもページ遷移ルールは共通とする。
  - いずれの運用でも `1080x1800` セーフ領域規約を守る。
  - 拡張運用時の切替UIはフッター `120 px` 内に収める。
  - 項目が複数ビューを持つ場合は、ビューの存在が常に分かる最小タブを表示し、1タップで切替可能にする。
  - 単一ビュー項目ではビュータブを表示しない。
  - 初期ビューの既定値は `text` とし、項目ごとに上書き可能とする。

## 13. 状態保存仕様
- 保存対象:
  - 最終読了位置（項目ID、ページ番号）
  - 最終ビュー（ビューID）
  - 表示設定（文字サイズ、行間、テーマ）
  - マーク情報（栞/復習）
- 起動時は最終読了位置へ復帰できること。
- 設定は作品単位で保持すること。

## 14. マーク仕様（栞/復習）
- 栞と復習は共通の「マーク」基盤で管理する。
- マーク種別:
  - `bookmark`（栞: 位置記録）
  - `review`（復習: あとで見直す対象）
- 各マークは最低限、`entryId`、`viewId`、`timestamp` を保持する。
- 一覧画面で種別ごとにフィルタできること。

## 15. 目次・章構成と並び順
- 目次は「章なし」構成と「章あり」構成の両方を許可する。
- 並び順モード:
  - `manual`（手動順）
  - `id`（ID順）
  - `date`（作成日順）
- 並び順モードは作品単位で選択できること。
- 目次は常に「項目タイトル」と「開始ページ」を表示すること。

## 16. 検索・フィルタ
- 項目タイトルの全文検索を提供する。
- 最低限のフィルタ:
  - 未読
  - 既読
  - 栞あり
  - 復習あり
- 検索/フィルタ結果から直接ジャンプできること。

## 17. エラー時フォールバック
- 画像ビューの読み込み失敗時:
  - 代替プレースホルダーを表示する。
  - 次に利用可能なビューへ切替できる導線を出す。
- ビュー欠損時:
  - 項目の初期ビューへ自動フォールバックする。
  - 初期ビューも不正な場合は項目一覧へ戻す。
- 重大エラー時でもアプリ全体が停止しないこと。

## 18. 受け入れ条件
- 全ページが `1080x1920` 論理フレーム内で正しく表示される。
- 主要コンテンツが `1080x1800` セーフ領域内に収まる。
- フッターUIが `120 px` 内で重なりなく表示される。
- 表紙、目次、項目ページの遷移が正しく動作する。
- 目次行が `88 px` 標準に従い、項目タイトルと開始ページを表示する。
- シンプル運用/拡張運用のいずれでも読書フローが破綻しない。
- 中央タップで操作オーバーレイの表示/非表示が正しく切り替わる。
- 複数ビュー項目ではビュータブが表示され、単一ビュー項目では非表示になる。
- 状態保存（位置、ビュー、表示設定、マーク）が復元される。
- 検索/フィルタ/マーク一覧から目的の項目へ到達できる。
- 画像欠損やビュー欠損でもフォールバックして閲覧継続できる。

## 19. 未確定項目
- タイポグラフィスケールと最終フォントファミリー
- 極小端末でのフッター挙動（固定/圧縮/オーバーレイ）
- テーマシステムの適用範囲
